<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,minimum-scale=1,initial-scale=1" name="viewport">
    <title>IOT Led</title>
    <link rel="stylesheet" href="./common.css">
</head>
<body>
<header>
    <h1>Led control panel</h1>
</header>
<main>
    <ul class="control-buttons">
        <li class="visible">
            <button id="connectButton">Connect</button>
        </li><li>
            <button id="disconnectButton">Disconnect</button>
        </li><li>
            <button id="lightOff">Light off</button>
        </li><li>
            <button id="toggleRedLight" data-code="3">Toggle red light</button>
        </li><li>
            <button id="toggleBlueLight" data-code="4">Toggle blue light</button>
        </li><li>
            <button id="toggleGreenLight" data-code="2">Toggle green light</button>
        </li><li>
            <button id="runBlinkLight" data-code="1">Run blink light</button>
        </li>
    </ul>
</main>
    
<script> 
    
  if (!navigator.bluetooth) {
  alert('Sorry, your browser doesn\'t support Bluetooth API');
}

var SEND_SERVICE = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
var SEND_SERVICE_CHARACTERISTIC = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';

const controlButtonsListElements = document.querySelectorAll('.control-buttons > li');
const connectButton = document.getElementById('connectButton');
const disconnectButton = document.getElementById('disconnectButton');
const lightOffButton = document.getElementById('lightOff');
const toggleRedLightButton = document.getElementById('toggleRedLight');
const toggleBlueLightButton = document.getElementById('toggleBlueLight');
const toggleGreenLightButton = document.getElementById('toggleGreenLight');
const runBlinkLightButton = document.getElementById('runBlinkLight');

let toggleLigthCharacteristic;
let myDevice;

connectButton.addEventListener('pointerup', connectButtonPointerUpHandler);

function connectButtonPointerUpHandler() {
  navigator.bluetooth.requestDevice({
    filters:
      [
        { services: [SEND_SERVICE] },
      ]
  })
    .then(device => {
      myDevice = device;

      return device.gatt.connect();
    })
    .then(server => server.getPrimaryService(SEND_SERVICE))
    .then(service => service.getCharacteristic(SEND_SERVICE_CHARACTERISTIC))
    .then(characteristic => {
      toggleLigthCharacteristic = characteristic;

      toggleButtonsVisible();
      toggleItemsEventListeners('addEventListener');
    })
    .catch(error => {
      console.error(error);
    });
}
</script>

    
</body>
</html>
